# ROS2 Helper

## 説明

ROS2 Helperは,VS CodeでROS2開発を行う際の効率を大幅に向上させるためのVScodeの拡張機能です.ROS2を使ったロボット開発では,複数のパッケージやノード,launchファイルを管理する必要があります.開発中は,それらを実行するためにターミナルで何度もコマンドを入力することが多く,開発の流れが中断されがちです.この拡張機能は,そうした煩雑な作業を自動化し,開発者がコーディングに集中できる環境を提供します.

本拡張機能の主な特徴は,ワークスペース内のすべてのパッケージ情報を自動的に解析し,CMakeLists.txtから実行可能ノードやコンポーネントノードを検出する点です.これにより,開発者はパッケージ構成を手動で把握する必要がなくなります.また,C++やPythonで記述されたノードのソースファイルを右クリックするだけで,対応するROS2ノードを新しいターミナルウィンドウで起動できます.従来のように ros2 run コマンドを入力する手間が省け,開発とテストのサイクルを高速化できます.
試験的にノードを実行したい場合にも役立つでしょう.

さらに,launchファイルの実行も簡単になります. .launch.pyファイルを右クリックして選択するだけで,適切な環境設定（setup.bashのsource）が自動的に行われ,launchファイルが実行されます.これにより,開発途中のlaunchファイルによるトライアンドエラーがより高速に回すことができます.

本拡張機能はTypeScriptで記述されたVS Code側のインターフェースと,Pythonで記述されたROS2ワークスペース解析エンジンから構成されており,両者間はJSON-RPC形式で通信しています.

本拡張機能により,ROS2開発者は煩雑なコマンド操作や,スペルミスから解放され,ロボット開発により多くの時間と思考を割くことができます.

## 機能

### 📦 ワークスペースの自動解析
起動時にROS2ワークスペースを自動的に解析し,以下を検出します：
- 実行可能ノード（CMakeLists.txtの`add_executable()`から）
- コンポーネントノード（`rclcpp_components_register_node()`から）
- 各パッケージの`launch/`ディレクトリ内のlaunchファイル

### 🚀 ノードの実行
C++やPythonのソースファイルを右クリックして **Run ROS2 Node** を選択すると,対応するROS2ノードが新しいターミナルウィンドウで起動します.
![ノードの実行メニュー](images/Screenshot%20from%202026-01-04%2015-17-35.png)
![ノードの実行メニュー](images/Screenshot%20from%202026-01-04%2015-37-13.png)

### 🎯 Launchファイルの実行
`.launch.py`ファイルを右クリックして**「Launch ROS2 File」**を選択すると,適切な環境設定で直接実行されます.
![launchファイルの実行メニュー](images/Screenshot%20from%202026-01-04%2015-23-13.png)
![launchファイルの実行メニュー](images/Screenshot%20from%202026-01-04%2015-34-52.png)

### 📊 ワークスペース情報の表示
検出されたパッケージ,ノード,launchファイルの詳細情報をデバッグコンソールで確認できます。

## スクリーンショット

### ワークスペースの読み込みと情報表示
![ワークスペース情報](images/Screenshot%20from%202026-01-04%2015-28-03.png)
*拡張機能が起動すると自動的にワークスペースを解析し,検出されたパッケージ情報をデバックコンソールに表示します**

## 動作要件

- **ROS2ディストリビューション**: Jazzy、Humbleなど対応バージョン
- **環境**: `gnome-terminal`がインストールされたLinux
- **ワークスペース**: `install/setup.bash`を含む、ビルド済みのROS2ワークスペース
- **環境変数**: `ROS_DISTRO`が設定されていること（例: `jazzy`, `humble`）

### セットアップ
拡張機能を使用する前に,ワークスペースをビルドしてください：
```bash
cd ~/your_ros2_workspace
colcon build
```

## 使い方

### ノードの実行
1. ノードのソースファイル（`.cpp`, `.cc`, `.cxx`, `.py`）を開く
2. エクスプローラーでファイルを右クリック
3. コンテキストメニューから**「Run ROS2 Node」**を選択
4. 新しいターミナルウィンドウでノードが起動します

### Launchファイルの実行
1. launchファイル（`.launch.py`, `.launch.xml`など）を開く
2. エクスプローラーでファイルを右クリック
3. コンテキストメニューから**「Launch ROS2 File」**を選択
4. 適切な環境設定でlaunchファイルが実行されます

### コマンドパレット
コマンドパレット（`Ctrl+Shift+P`）から以下のコマンドにアクセスできます：

- `ROS2 Helper: Load Workspace` - ワークスペース情報を再読み込み
- `ROS2 Helper: Show Workspace Info` - パッケージの詳細を出力パネルに表示
- `ROS2 Helper: Refresh Environment` - ROS2環境変数を更新

## 技術詳細

### アーキテクチャ
この拡張機能は以下で構成されています：

- **TypeScript拡張**（`extension.ts`） - VS Code統合とコマンド処理
- **Pythonバックエンド**（`python_file/`） - ROS2ワークスペース解析とプロセス管理

拡張機能はPythonのサブプロセスを起動し、ROS2環境とインターフェースしてワークスペース情報を提供し、ノードプロセスを管理します。

### 使用技術
- **言語**: TypeScript, Python
- **フレームワーク**: VS Code Extension API
- **通信**: JSON-RPC（標準入出力経由）
- **プロセス管理**: Node.js child_process, Python subprocess

### ファイル構成
```
ros2helper/
├── src/
│   ├── extension.ts          # メインの拡張機能ロジック
│   ├── logger.ts             # ログ出力ユーティリティ
│   └── ws_info.ts            # 型定義
├── python_file/
│   ├── main.py               # Pythonエントリーポイント
│   ├── dispatcher.py         # コマンドディスパッチャ
│   ├── load_ws.py            # ワークスペース解析
│   ├── ws_info.py            # ワークスペース情報取得
│   └── launch_processes.py  # プロセス管理
└── package.json              # 拡張機能マニフェスト
```

## トラブルシューティング

### ノードが検出されない場合
- パッケージに`package.xml`と`CMakeLists.txt`が存在することを確認
- ワークスペースがビルドされていることを確認: `colcon build`
- **「ROS2 Helper: Load Workspace」**を実行して更新

### ノードの起動に失敗する場合
- ワークスペースのルートに`install/setup.bash`が存在することを確認
- `ROS_DISTRO`環境変数が設定されていることを確認
- 出力パネルでエラーメッセージを確認

### 異なるターミナルエミュレータを使用したい場合
- この拡張機能はデフォルトで`gnome-terminal`を使用します
- 他のターミナルを使用する場合は、`launch_processes.py`の起動コマンドを修正してください

## 既知の問題

- 現在、`gnome-terminal`を使用するLinux環境のみサポート
- ノード検出にはワークスペースがビルド済みである必要があります
- コンポーネントノードはCMakeLists.txtに適切に登録されている必要があります

## 今後の改善予定

- ワークスペース情報のGUI表示
- Windows/macOS対応
- 他のターミナルエミュレータのサポート
- ノードの停止機能の追加
- 実行中のノード一覧表示

## 制作時期
2025年12月～2026年1月

## ライセンス

MIT License

---

**より快適なROS2開発をお楽しみください！**